{% extends 'base.html' %}
{% load static %}

{% block head %}

    <link rel="stylesheet" href="{% static 'login.css' %}">
{% endblock %}

{% block content %}
    <div class="login-box">
        <form id="loginForm" method="post">
            <div id="title-div">
                <label id="title-label">
                    <h2>Login</h2>
                </label>
            </div>

            {% csrf_token %}
            <div class="form-control">
                {{ form.username }}
                <label>Username</label>
            </div>
            <div class="form-control">
                {{ form.password }}
                <label>Password</label>
            </div>

            <div id="error-message"></div>

        <div class="button-parent">

        <div class="button" id="button-2">
            <div id="slide"></div>
            <a onclick="location.href='/signup/{% if next %}?next={{ next }}{% endif %}';">Sign Up</a>
        </div>

        <div class="button" id="button-2">
            <div id="slide"></div>
            <a onclick="document.getElementById('loginForm').submit();">Login</a>
        </div>


        </div>
        </form>
    </div>


    <script>
        const labels = document.querySelectorAll('.form-control label')

        labels.forEach(label => {
            label.innerHTML = label.innerText
                .split('')
                .map((letter, index) => `<span style="transition-delay:${index * 40}ms">${letter}</span>`)
                .join('')
        })
        //animation test ----------------------------------------------------------------

        document.getElementById('loginForm').addEventListener('submit', function (e) {
            e.preventDefault();
            let formData = new FormData(this);
            fetch('', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
            })
            .then(response => {
                if (response.ok) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const nextUrl = urlParams.get('next');

                    if (nextUrl) {
                        window.location.href = nextUrl;
                    } else {
                        window.location.href = '{% url 'index' %}';
                    }
                } else {
                    return response.json();
                }
            })
            .then(data => {
                if ('errors' in data) {
                    document.getElementById("error-message").textContent = "The username or password is incorrect.";
                }
            })
        });
    </script>



{% endblock %}
